
# 多语开发说明
## 迁移步骤
**如果字符串需要适配多语，使用`i18next.t`函数包裹**
步骤如下：
```javascript
// 1. 引入
import {i18next} from 'gm-i18n'

// 2. 普通使用
// before
let s = '测试'
// after
let s = i18next.t('测试')

// 3. 插值使用 
// before:
var s = '与已有规则' + keys[0] + '冲突' 
// after: 
i18next.t(/* tpl:与已有规则${VAR1}冲突 */'conflict', {VAR1:keys[0]})
// 上述代码含义为：在多语文件中找到 conflict 对应的模板(与已有规则${VAR1}冲突)，将 {VAR1:keys[0]} 插值代入，得到结果字符串

// 4. 通过工具同步新增的 key 到多语文件，见下文
```
**具体要不要插值，根据场景自己决定(主要考虑翻译的难度)。**

## 脚本
新增的词条要通过脚本扫描添加。默认是以扫描到的`key`作为翻译模板，如果需要自定义模板(比如插值情况)，可手动的添加注释标识。
```javascript
// 约定以tpl:开头，后面表示模板，注意注释的位置。
let str = i18next.t(/* tpl:测试${var2} */'key_name', {var2:keys[0]})
// 多语文件中生成如下映射
{
  "key_name": "测试${var2}"
}
```
### 使用
```bash
npm i gm-i18n-migrate -g

# 扫描项目的词条，同步到多语文件
i18n-m sync
```
### 后续维护
```bash
# 提取要翻译的词条到excel
i18n-m pick-xlsx

# 已翻译的 excel 文件合并到 jsonpath
i18n-m merge-xlsx ./已翻译的xlsx.xlsx [jsonpath]
```

### 文案替换
直接更新词条，跑脚本同步到多语文件。

```javascript
// before
let s1 = i18next.t('销售单')
let s2 = i18next.t(/* tpl:销售单${name} */'test', {name})

// after 销售单改为报价单 然后运行 i18n-m sync
<option value='0'>{i18next.t('报价单')}</option>
let s = i18next.t(/* tpl:报价单${name} */'test', {name})
```

## 其他
### KEY
1. `key`不要使用`KEY`开头的形式，这种格式表示是工具自动扫描生成的。
2. 某些情况下，同一中文对应的翻译可能不一样。通过添加命名空间来特殊处理，分隔符为`__`。比如导航栏的翻译因为UI限制要精简，添加`nav__`。

```javascript
{
  "nav__结算管理": "结算管理", // 如果有分隔符 sync会取最后一部分作为模板
  "结算管理": "结算管理"
}
{
  "nav__结算管理": "Finance",
  "结算管理": "Finance Mangement"
}
```

### moment
不依赖`moment`多语言相关。`format`写法统一如下
``` javascript
// before
moment(date).format('MM月DD日 HH时mm分');
// after
moment(date).format('MM-DD HH:mm');
```
有特殊需求提出来，在`gm-i18n`中添加接口来调用。
### 不依赖中文组词
```javascript
// before
const weekOptionList = ['日', '一', '二', '三', '四', '五', '六', '日'];
const str = `每周${weekOptionList[day]}`;

// after 周日，周一这些应该一起来翻译
const weekOptionList = [i18next.t('周日'), i18next.t('周一') /* ... */]
const str = `每${weekOptionList[day]}`
```


